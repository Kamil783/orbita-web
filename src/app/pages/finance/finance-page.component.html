<app-app-shell>
  <app-topbar [title]="title" placeholder="Поиск транзакций..."></app-topbar>

  <main class="page">
    <!-- Stats Section -->
    <div class="stats">
      <div class="stat-card">
        <p class="stat-card__label">Общий баланс</p>
        <p class="stat-card__value">12 450,00 &#8381;</p>
        <div class="stat-card__trend stat-card__trend--up">
          <span class="material-symbols-outlined">trending_up</span>
          <span>+2,4% за месяц</span>
        </div>
      </div>

      <div class="stat-card stat-card--accent">
        <p class="stat-card__label">Расходы за месяц</p>
        <p class="stat-card__value">2 105,40 &#8381;</p>
        <div class="stat-card__trend stat-card__trend--down">
          <span class="material-symbols-outlined">trending_down</span>
          <span>-5,1% от лимита</span>
        </div>
      </div>

      <div class="stat-card">
        <p class="stat-card__label">Цель накоплений</p>
        <p class="stat-card__value">5 000,00 &#8381;</p>
        <div class="stat-card__progress">
          <div class="stat-card__progress-bar">
            <div class="stat-card__progress-fill" style="width: 65%"></div>
          </div>
          <span class="stat-card__progress-text">65% — Фонд отпуска</span>
        </div>
      </div>
    </div>

    <!-- Two-column Layout -->
    <div class="content-grid">
      <!-- Left: Spending Trends -->
      <div class="chart-section">
        <div class="section-header">
          <h3 class="section-header__title">Динамика расходов</h3>
          <div class="tab-toggle">
            <button
              class="tab-toggle__btn"
              [class.tab-toggle__btn--active]="activeChartTab() === 'weekly'"
              (click)="setChartTab('weekly')"
            >
              По неделям
            </button>
            <button
              class="tab-toggle__btn"
              [class.tab-toggle__btn--active]="activeChartTab() === 'monthly'"
              (click)="setChartTab('monthly')"
            >
              По месяцам
            </button>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-card__header">
            <div>
              <p class="chart-card__amount">2 105,40 &#8381;</p>
              <p class="chart-card__period">Последние 30 дней</p>
            </div>
            <span class="chart-card__badge">В РАМКАХ ПЛАНА</span>
          </div>
          <div class="chart-card__canvas-wrapper">
            <canvas #spendingChart></canvas>
          </div>
        </div>
      </div>

      <!-- Right: Recent Transactions -->
      <div class="transactions-section">
        <div class="section-header">
          <h3 class="section-header__title">Последние операции</h3>
          <a class="section-header__link" href="javascript:void(0)">Все операции</a>
        </div>

        <div class="transactions-card">
          @for (tx of transactions; track tx.title) {
            <div class="transaction">
              <div
                class="transaction__icon"
                [style.background]="tx.iconBg"
                [style.color]="tx.iconColor"
              >
                <span class="material-symbols-outlined">{{ tx.icon }}</span>
              </div>
              <div class="transaction__info">
                <p class="transaction__title">{{ tx.title }}</p>
                <p class="transaction__date">{{ tx.date }}</p>
              </div>
              <p
                class="transaction__amount"
                [class.transaction__amount--negative]="tx.amount < 0"
                [class.transaction__amount--positive]="tx.amount > 0"
              >
                {{ formatAmount(tx.amount) }}
              </p>
            </div>
          }

          <button class="transactions-card__more" type="button">Загрузить ещё</button>
        </div>
      </div>
    </div>
  </main>
</app-app-shell>
